<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="manifest" href="./manifest.json">

    <title>Portfolio Optimization Methods</title>
    <link rel="icon" href="./src/img/icons/192x192.png" type="image/x-icon" />

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">

    <link rel="stylesheet" type="text/css" href="./src/main.css" />
    <link rel="stylesheet" href="./src/libs/css/pyscript_2022.12.1.css" />

    <script src="https://kit.fontawesome.com/65dc67808d.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm" crossorigin="anonymous"></script>

    <py-config>
        packages = [
            "qpsolvers==2.8.1",
            "pandas",
            "./src/libs/wheels/quadprog-0.1.11-cp310-cp310-emscripten_3_1_27_wasm32.whl",
            "./src/libs/wheels/portfolioperformance-1.0.0-py3-none-any.whl"
        ]

        [[fetch]]
        files = ["./data/new/processed/25_portfolios_1_factor.csv",
        "./data/new/processed/25_portfolios_3_factor.csv",
        "./data/new/processed/25_portfolios_4_factor.csv",
        "./data/new/processed/ff_4_factor.csv",
        "./data/new/processed/industry.csv",
        "./data/new/processed/international_factor.csv",
        "./data/new/processed/sp_sector.csv"]
    </py-config>

    <py-script src="./main.py"></py-script>
</head>
<body>
    
    <div class="container" style="opacity: 0.2;">

    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">

        <h1>Portfolio Optimization Methods</h1>
        <div class="d-flex">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                    <a class="nav-link" href="https://github.com/sidnand/Portfolio-Optimization-Interface" target="_blank">
                        <i class="fa-brands fa-github"></i>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="https://pypi.org/project/portfolioperformance/" target="_blank">
                        <i class="fa-solid fa-cube"></i>
                    </a>
                </li>
            </ul>
        </div>

        </div>
    </nav>

        <div class="row">

            <form onsubmit="return false;" id="form">
                <fieldset class="form-group">

                    <div>
                        <h5 for="">Load</h5>

                        <div>
                            <button class="preset btn btn-primary" id="preset_spsector" onclick='togglePreset("spsector")'>S&P 500 Sectors</button>
                            <button class="preset btn btn-primary" id="preset_industry" onclick='togglePreset("industry")'>Industry</button>
                            <button class="preset btn btn-primary" id="preset_international" onclick='togglePreset("international")'>International</button>
                            <button class="preset btn btn-primary" id="preset_25_1" onclick='togglePreset("25_1")'>25 Portfolios (1 Factor)</button>
                            <button class="preset btn btn-primary" id="preset_25_3" onclick='togglePreset("25_3")'>25 Portfolios (3 Factor)</button>
                            <button class="preset btn btn-primary" id="preset_25_4" onclick='togglePreset("25_4")'>25 Portfolios (4 Factor)</button>
                            <button class="preset btn btn-primary" id="preset_ff4" onclick='togglePreset("ff4")'>4 Factor</button>
                        </div>
                    </div>

                    <br>

                    <div>
                        <h5 for="file">Upload</h5>
                        <button class="btn btn-primary" onclick="openUploadDialogue()">Pick CSV File</button><label id="filename"></label>

                        <input style="display: none;" type="file" class="custom-file-input" name="file" id="file" accept=".csv" onchange="showFileName()" />
                    </div>

                </fieldset>

                <fieldset class="form-group">

                    <h5 for="delim">Delimiter Type</h5>

                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio"  name="delim" value="comma" checked>
                        <label class="form-check-label" for="flexRadioDefault1">Comma</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="delim" value="space-tab">
                        <label class="form-check-label" for="flexRadioDefault2">Space/Tab</label>
                    </div>


                </fieldset>

                <fieldset class="form-group">

                    <h5>Data Options</h5>

                    <div>
                        <label for="">
                            Date Format
                        
                            <span data-bs-toggle="tooltip" data-bs-placement="right" data-bs-html="true" data-bs-toggle="tooltip"
                            data-bs-title="
                                <p>Y: 4 digit year</p>
                                <p>y: 2 digit year</p>
                                <p>m: month</p>
                                <p>d: day</p>">
                                <i class="fa-solid fa-circle-question"></i>
                            </span>
                        </label>
                        <input type="text" class="form-control" name="date-format" placeholder="Default: Y-m-d" />
                        
                        <label for="">Risk Factor Asset Position (Multiple Positions; Position 1 is the First Asset)</label>
                        <input type="text" class="form-control" name="risk-factor" placeholder="Default: None" />
                        
                        <label for="">Risk Free Asset Position (Only 1 Position)</label>
                        <input type="text" class="form-control" name="risk-free" placeholder="Default: 1" />
                    </div>

                </fieldset>

                <fieldset class="form-group">

                    <h5>Model Properties</h5>

                    <div>
                        <label for="">Time Horizons</label>
                        <input type="text" class="form-control" name="time-horizons" placeholder="ex: 60, 120">
                        
                        <label for="">Gamma Values</label>
                        <input type="text" class="form-control" name="gammas" id="gammas" placeholder="ex: 1, 2, 3">
                    </div>

                </fieldset>

                <fieldset class="form-group">

                    <h5>Date Range</h5>
                    <p>Optional, using date format</p>

                    <div class="row">
                        <div class="col">
                            <label for="">From</label>
                            <input type="text" class="form-control" name="date-range-start">
                        </div>
                        
                        <div class="col">
                            <label for="">To</label>
                            <input type="text" class="form-control" name="date-range-end">
                        </div>
                    </div>

                </fieldset>

                <fieldset class="form-group">

                    <h5>Select Models</h5>

                    <div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" name="model" value="1">
                            <label for="">Minimum-Variance</label>
                        </div>

                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" name="model" value="2">
                            <label for="">Minimum-Varaince Shortsale Constraints</label>
                        </div>
                        
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" name="model" value="3">
                            <label for="">Minimum-Varaince Generalized Constraints (Jagannathan Ma)</label>
                        </div>

                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" name="model" value="4">
                            <label for="">Kan Zhou Equal Weighted</label>
                        </div>

                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" name="model" value="5">
                            <label for="">Mean-Varaince (Markowitz)</label>
                        </div>

                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" name="model" value="6">
                            <label for=""></label>Mean-Variance Shortsale
                        </div>

                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" name="model" value="7">
                            <label for=""></label>Kan Zhou (2007) "three-fund
                        </div>

                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" name="model" value="8">
                            <label for=""></label>Bayes-Stein
                        </div>

                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" name="model" value="9">
                            <label for=""></label>Bayes-Stein Shortsale
                        </div>

                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" name="model" value="10">
                            <label for="">MacKinlay and Pastor’s (2000)</label>
                        </div>
                    </div>

                </fieldset>

                <fieldset class="form-group">
                    <button class="btn btn-primary" onclick="handleFormSubmit()">Run</button>
                </fieldset>
            </form>

        </div> <!-- End of menu -->

        <div class="row" id="results">
            <table class="table" id="table_sharpes"></table>
            <table class="table" id="table_signifs" style="margin-top: 50px;"></table>
        </div> <!-- End of results -->

    </div> <!-- End of container -->

    <script>
        if ("serviceWorker" in navigator) {
            navigator.serviceWorker.register("service_worker.js").then(registration => console.log("SW Registered!"))
            .catch(error => console.log("SW Registration Failed"));
        } else console.log("Not supported");

        // Initialize tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
          return new bootstrap.Tooltip(tooltipTriggerEl)
        })
    </script>

    <script defer src="./src/libs/js/pyodide_0.22.1.js"></script>
    <script defer src="./src/libs/js/pyscript_2022.12.1.js"></script>

    <script>
        let load = (x) => {
            let container = document.getElementsByClassName('container')[0]

            if (x) {
                container.style.opacity = 0.2
            } else {
                container.style.opacity = 1
            }
        }
    </script>

    <script defer src="./src/main.js"></script>

    <script defer>
        function createObject(object, variableName) {
            //Bind a variable whose name is the string variableName
            // to the object called 'object'
            let execString = variableName + " = object"
            console.log("Running '" + execString + "'");
            eval(execString)
        
            load(false)
        }
    </script>

</body>
</html>